const asyncHandler = require('express-async-handler');\nconst Post = require('../models/Post');\nconst slugify = require('../utils/slugify');\n\nconst listPosts = asyncHandler(async (req, res) => {\n  let { page = 1, limit = 10, q, tag, authorId, sort } = req.query;\n  page = parseInt(page);\n  limit = parseInt(limit);\n  const filter = {};\n  if (q) {\n    filter.$or = [\n      { title: new RegExp(q, 'i') },\n      { content: new RegExp(q, 'i') }\n    ];\n  }\n  if (tag) filter.tags = tag;\n  if (authorId) filter.author = authorId;\n\n  let query = Post.find(filter).populate('author', 'name email');\n  if (sort) query = query.sort(sort);\n  const total = await Post.countDocuments(filter);\n  const posts = await query.limit(limit).skip((page - 1) * limit);\n  res.json({ success: true, count: total, data: posts });\n});\n\nmodule.exports = { listPosts };
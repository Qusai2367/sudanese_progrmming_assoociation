const asyncHandler = require('express-async-handler');\nconst crypto = require('crypto');\nconst User = require('../models/User');\nconst { generateToken } = require('../utils/jwt');\nconst { sendMail } = require('../utils/mail');\n\nconst register = asyncHandler(async (req, res) => {\n  const { name, email, password, role } = req.body;\n  if (!name || !email || !password) {\n    res.status(400);\n    throw new Error('Name, email and password are required');\n  }\n  const exists = await User.findOne({ email });\n  if (exists) {\n    res.status(400);\n    throw new Error('Email already registered');\n  }\n  const user = await User.create({ name, email, password, role });\n  const token = generateToken(user);\n  res.status(201).json({ user: { id: user._id, name: user.name, email: user.email, role: user.role }, token });\n});
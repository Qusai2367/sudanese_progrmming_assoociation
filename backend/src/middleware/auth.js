const jwt = require('jsonwebtoken');\nconst asyncHandler = require('express-async-handler');\nconst User = require('../models/User');\n\nconst protect = asyncHandler(async (req, res, next) => {\n  const authHeader = req.headers.authorization;\n  if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    res.status(401);\n    throw new Error('Not authorized, token missing');\n  }\n  const token = authHeader.split(' ')[1];\n  try {\n    const decoded = jwt.verify(token, process.env.JWT_SECRET);\n    const user = await User.findById(decoded.id).select('-password');\n    if (!user) {\n      res.status(401);\n      throw new Error('Not authorized, user not found');\n    }\n    req.user = user;\n    next();\n  } catch (err) {\n    res.status(401);\n    throw new Error('Not authorized, token failed');\n  }\n});\n\nmodule.exports = { protect };